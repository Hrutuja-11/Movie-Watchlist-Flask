{% from "macros/fields.html" import render_text_field, render_area_field %}
{% extends "layout.html" %}

{% block head_content %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/forms.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock %}

{% block main_content %}
<div class="profile-page">
    <!-- Profile Hero Section -->
    <div class="profile-hero">
        <div class="profile-hero__background"></div>
        <div class="profile-hero__content">
            <div class="profile-hero__avatar-wrapper">
                {% if user.avatar_url %}
                    <img src="{{ user.avatar_url }}" alt="{{ user.name or user.email }}" class="profile-hero__avatar">
                {% else %}
                    <div class="profile-hero__avatar-placeholder">
                        {{ (user.name or user.email)[0].upper() }}
                    </div>
                {% endif %}
                <div class="profile-hero__avatar-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
            </div>
            <div class="profile-hero__info">
                <h1 class="profile-hero__name">{{ user.name if user.name else 'Movie Enthusiast' }}</h1>
                <p class="profile-hero__email">{{ user.email }}</p>
                {% if user.bio %}
                    <p class="profile-hero__bio">{{ user.bio }}</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="profile-stats-grid">
        <div class="profile-stat-card">
            <div class="profile-stat-card__icon profile-stat-card__icon--movies">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
                </svg>
            </div>
            <div class="profile-stat-card__content">
                <span class="profile-stat-card__number">{{ movie_count }}</span>
                <span class="profile-stat-card__label">Movies in Watchlist</span>
            </div>
        </div>
        <div class="profile-stat-card">
            <div class="profile-stat-card__icon profile-stat-card__icon--member">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
            </div>
            <div class="profile-stat-card__content">
                <span class="profile-stat-card__number">Active</span>
                <span class="profile-stat-card__label">Account Status</span>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="profile-actions">
        <a href="{{ url_for('pages.index') }}" class="profile-action-card">
            <div class="profile-action-card__icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                </svg>
            </div>
            <span class="profile-action-card__label">View Watchlist</span>
        </a>
        <a href="{{ url_for('pages.add_movie') }}" class="profile-action-card">
            <div class="profile-action-card__icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
            </div>
            <span class="profile-action-card__label">Add Movie</span>
        </a>
    </div>

    <!-- Edit Profile Section -->
    <div class="profile-edit-card">
        <div class="profile-edit-card__header">
            <h2 class="profile-edit-card__title">Edit Profile</h2>
            <p class="profile-edit-card__subtitle">Update your profile information</p>
        </div>
        <form name="profile" method="post" novalidate class="profile-edit-card__form">
            {{ form.hidden_tag() }}
            
            <div class="profile-form-grid">
                <div class="profile-form-group">
                    <label class="profile-form-label">Display Name</label>
                    {{ form.name(class_="profile-form-input", placeholder="Enter your name") }}
                </div>
                
                <div class="profile-form-group">
                    <label class="profile-form-label">Email Address</label>
                    <input type="email" class="profile-form-input profile-form-input--disabled" value="{{ user.email }}" disabled>
                    <span class="profile-form-hint">Email cannot be changed</span>
                </div>
            </div>
            
            <div class="profile-form-group">
                <label class="profile-form-label">Bio</label>
                {{ form.bio(class_="profile-form-textarea", placeholder="Tell us about yourself...", rows="4") }}
            </div>
            
            <div class="profile-form-group">
                <label class="profile-form-label">Avatar URL</label>
                {{ form.avatar_url(class_="profile-form-input", placeholder="https://example.com/avatar.jpg") }}
                <span class="profile-form-hint">Enter a URL to an image for your profile picture</span>
            </div>
            
            <div class="profile-form-actions">
                {{ form.submit(class_="profile-form-button profile-form-button--primary") }}
                <a href="{{ url_for('pages.index') }}" class="profile-form-button profile-form-button--secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
