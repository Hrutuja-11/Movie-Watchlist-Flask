{% macro header(email, theme) %}
{% from "macros/svgs.html" import sun, moon %}
<header class="header">
    <div class="nav-container">
        <a href="{{ url_for('pages.index') }}" class="header__logo">
            <svg xmlns="http://www.w3.org/2000/svg" class="logo__icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
            </svg>
            <span class="logo__name">WatchVault</span>
        </a>
        <nav class="nav">
            {% if not email %}
                <a href="{{ url_for('pages.login') }}" class="nav__link">
                    <span class="nav__item">Log in</span>
                </a>
                <a href="{{ url_for('pages.register') }}" class="nav__link {{ 'nav__link--active' if request.path == url_for('pages.register') }}">
                    <span class="nav__item">Register</span>
                </a>
            {% else %}
                <form class="nav__search" action="{{ url_for('pages.search') }}" method="get">
                    <input
                        type="text"
                        name="q"
                        class="nav__search-input"
                        placeholder="Search movies..."
                        value="{{ request.args.get('q', '') }}"
                    >
                    <button type="submit" class="nav-search-button" aria-label="Search">
                        <svg xmlns="http://www.w3.org/2000/svg" class="nav-search-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M11 5a6 6 0 100 12 6 6 0 000-12z" />
                        </svg>
                    </button>
                </form>
                <a href="{{ url_for('pages.home') }}" class="nav__link">
                    <span class="nav__item">Movies</span>
                </a>
                <a href="{{ url_for('pages.home') }}" class="nav__link nav__link--primary">
                    <span class="nav__item">Watchlist</span>
                </a>
                <div class="profile-dropdown">
                    <button class="profile-dropdown__trigger" type="button">
                        {% if current_user and current_user.avatar_url %}
                            <img src="{{ current_user.avatar_url }}" alt="Profile" class="profile-dropdown__avatar">
                        {% else %}
                            <div class="profile-dropdown__avatar-placeholder">
                                {{ (current_user.name if current_user and current_user.name else email)[0].upper() }}
                            </div>
                        {% endif %}
                        <svg class="profile-dropdown__arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div class="profile-dropdown__menu">
                        <div class="profile-dropdown__header">
                            {% if current_user and current_user.avatar_url %}
                                <img src="{{ current_user.avatar_url }}" alt="Profile" class="profile-dropdown__header-avatar">
                            {% else %}
                                <div class="profile-dropdown__header-avatar-placeholder">
                                    {{ (current_user.name if current_user and current_user.name else email)[0].upper() }}
                                </div>
                            {% endif %}
                            <div class="profile-dropdown__header-info">
                                <span class="profile-dropdown__name">{{ current_user.name if current_user and current_user.name else 'User' }}</span>
                                <span class="profile-dropdown__email">{{ email }}</span>
                            </div>
                        </div>
                        <div class="profile-dropdown__divider"></div>
                        <a href="{{ url_for('pages.profile') }}" class="profile-dropdown__item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="profile-dropdown__icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            My Profile
                        </a>
                        <a href="{{ url_for('pages.index') }}" class="profile-dropdown__item">
                            <svg xmlns="http://www.w3.org/2000/svg" class="profile-dropdown__icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
                            </svg>
                            My Watchlist
                            <span class="profile-dropdown__badge">{{ watchlist_count }}</span>
                        </a>
                        <div class="profile-dropdown__divider"></div>
                        <a href="{{ url_for('pages.toggle_theme', current_page=request.path) }}" class="profile-dropdown__item">
                            {% if theme == "dark" %}
                                {{ sun("profile-dropdown__icon") }}
                                Light Mode
                            {% else %}
                                {{ moon("profile-dropdown__icon") }}
                                Dark Mode
                            {% endif %}
                        </a>
                        <div class="profile-dropdown__divider"></div>
                        <a href="{{ url_for('pages.logout') }}" class="profile-dropdown__item profile-dropdown__item--danger">
                            <svg xmlns="http://www.w3.org/2000/svg" class="profile-dropdown__icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                            Log Out
                        </a>
                    </div>
                </div>
            {% endif %}
        </nav>
    </div>
</header>
{% endmacro %}